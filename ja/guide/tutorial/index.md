# チュートリアル

このチュートリアルでは、EC サイトの購買ログ（ダミーデータ）を用いて、Recotem の基本的なワークフローを学びます。データのアップロードからモデルのチューニング・学習、そして推薦 API の呼び出しまでを一通り体験します。

## 1. データの準備

チュートリアルで使用する購買履歴データ `purchase_log.csv` を<a href="https://raw.githubusercontent.com/codelibs/recotem/refs/tags/v1.0.0/frontend/e2e/test_data/purchase_log.csv" download="purchase_log.csv">こちら</a>からダウンロードします。このデータは「どのユーザーがどの商品を購入したか」を記録するシンプルな履歴データです:

| user_id | item_id |
| ------- | ------- |
| 1       | 49      |
| 1       | 69      |
| 2       | 21      |
| 2       | 57      |

## 2. ログイン

[http://localhost:8000](http://localhost:8000) にアクセスすると、ログイン画面が表示されます。[インストール](../installation)直後は、以下の情報でログインできます。

- ユーザー名: `admin`
- パスワード: `very_bad_password`

ユーザー名とパスワードを入力し、「Login」ボタンをクリックします。

## 3. プロジェクトの作成

ログインするとプロジェクト選択画面が表示されます。右上の **"New Project"** ボタンをクリックして新しいプロジェクトを作成します。

Recotem では「プロジェクト」がデータ管理の基本単位です。同一プロジェクト内のデータは同じカラム構成である必要があります。

今回のデータには `user_id` と `item_id` の 2 つのカラムがあるため、以下のように入力します:

- **Project name**: 任意の名前（例: `fashion-ec`）
- **User column**: `user_id`
- **Item column**: `item_id`

入力したら「Create new project」をクリックします。

## 4. データのアップロード

プロジェクト画面に移動したら、サイドバーからデータ管理ページに移動し、「Upload」ボタンをクリックします。ファイル選択欄で先ほどダウンロードした `purchase_log.csv` を選択し、アップロードします。

## 5. チューニングウィザード

データをアップロードしたら、チューニングを開始します。サイドバーからチューニングページに移動し、ウィザードに従って 4 ステップで設定します。

### Step 1: データの選択

チューニングに使用する学習データを選択します。先ほどアップロードした `purchase_log.csv` を選択して次へ進みます。

### Step 2: 分割設定（Split Config）

学習データの分割方法を設定します。デフォルト値のまま「Continue」をクリックします。

### Step 3: 評価設定（Evaluation Config）

評価指標や推薦件数を設定します。デフォルト値のまま「Continue」をクリックします。

### Step 4: ジョブ設定

探索するアルゴリズムの種類や試行回数を設定します。デフォルト値のまま「Start the job」をクリックします。

## 6. チューニング結果の確認

ジョブが開始されると、チューニングジョブ詳細画面に移動します。進行状況はログパネルで確認できます。

ジョブが完了すると、探索されたアルゴリズムとパラメータの一覧が「Results」パネルに表示されます。各行には性能指標（NDCG 等）とパラメータが記載されています。最も性能の良いモデル設定は自動的に保存されます。

## 7. モデルの学習

チューニング結果から最適なモデル設定が自動的に作成されます。サイドバーからモデル学習ページに移動し、モデル設定を選択して「Train」をクリックすることで、全データを用いたモデルの学習が開始されます。

学習が完了すると、学習済みモデルが一覧に追加されます。

## 8. デプロイメントスロットの作成

学習済みモデルを推薦 API として配信するには、デプロイメントスロットを作成します。

サイドバーからデプロイメントスロットページに移動し、「Create Slot」をクリックします。スロット名を入力し、先ほど学習したモデルを選択して保存します。

## 9. API キーの作成

推薦 API を呼び出すには、`predict` スコープを持つ API キーが必要です。

サイドバーから API キー管理ページに移動し、「Create API Key」をクリックします。名前を入力し、スコープから `predict` を選択して作成します。

::: warning
API キーは作成時にのみ表示されます。必ずコピーして安全な場所に保管してください。
:::

## 10. 推薦 API の呼び出し

API キーとデプロイメントスロットが準備できたら、推薦 API を呼び出すことができます。

### 単一ユーザーへの推薦

```bash
curl -X POST http://localhost:8000/inference/predict/project/{project_id} \
  -H "Content-Type: application/json" \
  -H "X-API-Key: {your_api_key}" \
  -d '{"user_id": "1", "n_recommendations": 10}'
```

`{project_id}` にはプロジェクトの ID を、`{your_api_key}` には先ほど作成した API キーを指定します。

レスポンスとして、推薦アイテムの ID リストが JSON 形式で返されます。

```json
{
  "user_id": "1",
  "recommendations": ["42", "15", "78", "3", "91", "27", "56", "8", "64", "33"],
  "model_id": 1,
  "slot_name": "default"
}
```

これで Recotem の基本的なワークフロー --- データアップロード、チューニング、学習、デプロイ、API 呼び出し --- を一通り体験しました。
